
### 存储器
我们正常编译生成的二进制文件，需要下载烧录到单片机里面去，这个文件保存在单片机的ROM中，ROM这个名称指的是「read only memory」的意思，所有可以完成「read only memory」这种特性的存储介质都可以称为ROM。

1.分类
ROM一般可以分为四大类：
1）PROM (Programmable Read-Only Memory)，可编程只读存储器，也叫One-Time Programmable (OTP) ROM“一次可编程只读存储器”，是一种可以用程，只可以擦写一次，例如芯片的全球唯一ID码。
2）EPROM (Erasable Programmable Read-Only Memory），可擦除可编程只读存储器，一旦编程完成后，EPROM只能用强紫外线照射来擦除。
3）EEPROM (Electrically Erasable Programmable read only memory)是指带电可擦可编程只读存储器。是一种掉电后数据不丢失的存储芯片。
4）FLASH，可以擦写多次，按扇区/块擦除。
我们一般使用的单片机里面使用的是EEPROM（E2PROM），STM32则使用FLASH。

2.EPROM
电擦除和紫外线擦除是两种不同的擦除方式，我现在知道用紫外线擦除的ROM是EPROM。

EPROM是一种具有可擦除功能，擦除后即可进行再编程的ROM内存，写入前必须先把里面的内容用紫外线照射它的IC卡上的透明视窗的方式来清除掉。这一类芯片比较容易识别，其封装中包含有“石英玻璃窗”，一个编程后的EPROM芯片的“石英玻璃窗”一般使用黑色不干胶纸盖住， 以防止遭到阳光直射。EPROM内资料的写入要用专用的编程器，并且往芯片中写内容时必须要加一定的编程电压（VPP=12~24V，随不同的芯片型号而定）。

EPROM的型号是以27开头的，如27C020(8*256K)是一片2M Bits容量的EPROM芯片。EPROM芯片在写入资料后，还要以不透光的贴纸或胶布把窗口封住，以免受到周围的紫外线照射而使资料受损。

3.EEPROM
EEPROM拯救了这一切？
EEPROM的全称是「电可擦除可编程只读存储器」，即Electrically Erasable Programmable Read-Only Memory。EEPROM的出现可以说是跨时代的，因为ROM可以多次编程了，对于程序员来说，终于可以多次烧写单片机了，更让我们兴奋的是，我们可以使用电擦除，而不是紫外线擦除了。
从擦除次数上，EEPROM可以擦除100W次，而且EEPROM可以针对每一个区块，也就是每一个位置写 「0」或者 写 「1」，如果大家知道FLASH特性的话，就会觉得EEPROM是多么优秀。而且数据的保存时间可以达到100年。
当然了，特点就是电路复杂，成本高，因为成本高就导致了EEPROM的大小不是非常大，一般在512KB 以下。

4.Flash

如果从电擦除这个特性上说的话，FLASH也是EEPROM的一种，不同的是，FLASH的擦除区块不是一个字节，而是扇区来擦除，也是因为这样的特性，才导致FLASH价格比EEPROM便宜。


闪存（Flash Memory）是一种长寿命的非易失性（在断电情况下仍能保持所存储的数据信息）的存储器。用途SD卡、固态硬盘、芯片内存存储单元存储代码。


### 内部FLASH


1.主要特性


2.操作技巧


3.编程/擦除位数与电压之间的关系


4.单位
 字节：8位
 半字：16位
 字：32位
 双字：64位

 uint32_t i;
 uint64_t i;

 word i;
dword i;


### 编程细节

1.以分区形式进行规划，配置数据最好从最后扇区进行操作，防止覆盖扇区0的代码。


2.写入数据之前得先擦除数据，类似与读书时的黑板原理。




## 思考题

思考题1：擦除完之后，扇区里面所有的数据是什么？

答：所有的数据都是为0xFF，所有bit位都是1。


思考题2：假如说现在已经擦除完扇区，先写入了1个字，然后在下一个偏移地址再次写入新的字是否在需要擦除扇区？
答案：不需要的。

思考题3：假如说现在已经擦除完扇区，先写了1个字，然后在同一个地址再次写入新的字是否需要擦除扇区？
答案：需要进行擦除！

例子，已经写入数据为0x12345678，然后再写入新的数据为0x1111111，最后得到的数据居然是0x101010.


总结：
判断是否允许写入字，只需要判断当前的地址存储的数据是否为0xFFFFFFFF，若为0xFFFFFFFF，可以写入数据，不需要进行扇区擦除。



## 练习
对某一扇区连续写入64字的数据，并读取验证数据是否正确！
练习2.
温湿度数据记录仪，实现步骤如下：
按下KEY1或串口1接收到”start”，启动温湿度数据记录模式，每1秒（做项目的时候，改为6秒以上，低于30秒），将读取到温湿度模块数据保存到STM32内部FLASH当中，最大记录数目100条。
按下KEY2或串口1接收到”stop”，停止温湿度数据记录。
按下KEY3或串口1接收到”show”，显示当前所有温湿度所有记录，显示格式如下：
[001]2020/03/25 Week 6 9:40:12 Temp=30.0 Humi=92.0
[002]2020/03/25 Week 6 9:42:32 Temp=31.0 Humi=93.0
......
按下KEY4或串口1接收到”clear”，清空所有温湿度数据记录。
          
如何界定存储的数据达到100条？如果超过100条记录，请打印“存储已满”。
 
应用场景：例如智能手表存储用户的身体健康的数据；指纹锁与密码锁，指纹数据与密码数据都可以存储到FLASH。